<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>活動管理平台</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap");

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: linear-gradient(
          135deg,
          #1a1a1a 0%,
          #2d2d2d 50%,
          #1a1a1a 100%
        );
        background-size: 400% 400%;
        animation: gradientShift 20s ease infinite;
        min-height: 100vh;
        color: #e5e5e5;
        position: relative;
      }

      body::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: radial-gradient(
            circle at 20% 20%,
            rgba(255, 255, 255, 0.03) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 80% 80%,
            rgba(0, 0, 0, 0.1) 0%,
            transparent 50%
          );
        pointer-events: none;
        z-index: -1;
      }

      @keyframes gradientShift {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      .header {
        text-align: center;
        color: #ffffff;
        margin-bottom: 40px;
        position: relative;
      }

      .header h1 {
        font-size: 3.5em;
        margin-bottom: 5px;
        font-weight: 800;
        color: #ffffff;
        letter-spacing: 3px;
        text-transform: uppercase;
      }
      
      .header-subtitle {
        font-size: 1.1em;
        color: #cccccc;
        font-weight: 300;
        letter-spacing: 1px;
        margin-bottom: 15px;
      }

      .main-content {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin-bottom: 30px;
      }

      .card {
        background: rgba(40, 40, 40, 0.95);
        border-radius: 16px;
        padding: 16px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4),
          inset 0 1px 0 rgba(255, 255, 255, 0.1);
        -webkit-backdrop-filter: blur(10px);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        position: relative;
        overflow: hidden;
      }

      .card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: linear-gradient(90deg, #666666, #999999, #666666);
      }

      .calendar-section h2,
      .add-event-section h2 {
        color: #ffffff;
        margin-bottom: 16px;
        font-size: 1.4em;
        font-weight: 700;
      }

      .calendar {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 8px;
        margin-top: 15px;
      }

      .calendar-header {
        text-align: center;
        font-weight: bold;
        padding: 12px;
        background: linear-gradient(135deg, #666666, #888888);
        color: white;
        border-radius: 8px;
        font-size: 0.9em;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      }

      .calendar-day {
        aspect-ratio: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 1px solid #555555;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 600;
        position: relative;
        background: rgba(60, 60, 60, 0.8);
        color: #e5e5e5;
      }

      .calendar-day:hover {
        background: linear-gradient(135deg, #777777, #999999);
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
      }

      .calendar-day.selected {
        background: linear-gradient(135deg, #666666, #888888);
        color: white;
        border-color: #999999;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
      }

      .calendar-day.has-event::after {
        content: "●";
        position: absolute;
        bottom: 4px;
        right: 4px;
        font-size: 8px;
        color: #cccccc;
      }
      
      .calendar-day.past-date {
        color: #777777;
        background: rgba(40, 40, 40, 0.8);
      }
      
      .calendar-day.past-date.has-event::after {
        color: #777777;
      }

      .form-group {
        margin-bottom: 12px;
      }

      .form-group label {
        display: block;
        margin-bottom: 4px;
        font-weight: 600;
        color: #e5e5e5;
        font-size: 0.9em;
      }

      .form-group input,
      .form-group textarea {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid #555555;
        border-radius: 6px;
        font-size: 14px;
        transition: all 0.3s ease;
        background: rgba(60, 60, 60, 0.9);
        color: #e5e5e5;
        font-family: "Inter", sans-serif;
      }

      .form-group input:focus,
      .form-group textarea:focus {
        outline: none;
        border-color: #888888;
        box-shadow: 0 0 0 2px rgba(136, 136, 136, 0.2);
        background: rgba(70, 70, 70, 0.9);
      }

      .form-group textarea {
        height: 120px;
        resize: vertical;
      }
      
      .add-event-modal .form-group textarea {
        height: 130px;
      }

      .form-group input::placeholder,
      .form-group textarea::placeholder {
        color: #999999;
        font-size: 13px;
      }

      .submit-btn {
        background: linear-gradient(135deg, #666666, #888888);
        color: white;
        padding: 10px 25px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.3s ease;
        width: 100%;
        box-shadow: 0 3px 12px rgba(0, 0, 0, 0.3);
        position: relative;
        overflow: hidden;
      }

      .submit-btn::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.1),
          transparent
        );
        transition: left 0.5s ease;
      }

      .submit-btn:hover {
        background: linear-gradient(135deg, #777777, #999999);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
      }

      .submit-btn:hover::before {
        left: 100%;
      }

      .events-section {
        grid-column: 1 / -1;
      }

      .events-section h2 {
        color: #ffffff;
        margin-bottom: 30px;
        font-size: 2.5em;
        text-align: center;
        font-weight: 800;
        position: relative;
      }

      .events-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 20px;
      }

      .event-card {
        background: rgba(45, 45, 45, 0.98);
        border-radius: 12px;
        padding: 25px;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4),
          inset 0 1px 0 rgba(255, 255, 255, 0.05);
        -webkit-backdrop-filter: blur(10px);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
        cursor: pointer;
        position: relative;
        overflow: hidden;
      }

      .event-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, #666666, #888888, #666666);
      }

      .event-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 45px rgba(0, 0, 0, 0.5),
          inset 0 1px 0 rgba(255, 255, 255, 0.1);
      }

      .event-card.sponsored {
        background: rgba(55, 55, 55, 0.98);
        border: 2px solid #888888;
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.5),
          inset 0 1px 0 rgba(255, 255, 255, 0.1);
        position: relative;
      }

      .event-card.sponsored::before {
        background: linear-gradient(90deg, #888888, #aaaaaa, #888888);
      }

      .event-card.sponsored .event-title {
        color: #ffffff;
      }

      .event-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 15px;
      }

      .event-title {
        font-size: 1.4em;
        font-weight: 700;
        color: #ffffff;
        margin-bottom: 8px;
        line-height: 1.3;
      }

      /* 彈窗中的活動標題設為黑色 */
      .event-modal .event-title {
        color: #000000;
      }

      .event-date {
        font-size: 0.9em;
        color: #cccccc;
        font-weight: 500;
        background: rgba(80, 80, 80, 0.6);
        padding: 4px 10px;
        border-radius: 4px;
        display: inline-block;
      }

      .event-status {
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.8em;
        font-weight: 600;
      }

      .status-pending {
        background: linear-gradient(135deg, #666666, #777777);
        color: white;
      }

      .status-approved {
        background: linear-gradient(135deg, #888888, #aaaaaa);
        color: white;
      }

      .status-sponsored {
        background: linear-gradient(135deg, #999999, #bbbbbb);
        color: #333333;
        font-weight: 700;
      }

      .event-content {
        margin-bottom: 15px;
        color: #cccccc;
        line-height: 1.6;
        font-weight: 400;
      }

      .event-details {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
      }

      .event-location {
        font-size: 0.9em;
        color: #ffffff;
        font-weight: 600;
      }

      .event-cost {
        font-weight: 700;
        color: #ffffff;
        font-size: 1.1em;
        background: rgba(120, 120, 120, 0.8);
        padding: 5px 12px;
        border-radius: 4px;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        z-index: 1000;
      }
      
      /* 日期活動彈窗的z-index */
      #dailyEventsModal {
        z-index: 1000;
      }
      
      /* 確保活動詳情彈窗在日期活動彈窗之上 */
      #eventModal {
        z-index: 1100;
      }

      .modal-content {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 30px;
        border-radius: 15px;
        max-width: 600px;
        width: 90%;
        max-height: 85vh;
        overflow-y: auto;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
      }
      
      .modal-content.add-event-modal {
        max-width: 900px;
        padding: 0;
        background: rgba(28, 28, 30, 0.95);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.6);
        overflow: hidden;
        max-height: 85vh;
        display: flex;
        flex-direction: column;
      }
      
      .modal-header {
        background: linear-gradient(135deg, #333333, #222222);
        padding: 20px 30px;
        position: relative;
        border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        flex-shrink: 0;
      }
      
      .modal-body {
        padding: 30px;
        overflow-y: auto;
        flex: 1;
        /* 自定義滾動條樣式 */
        scrollbar-width: thin;
        scrollbar-color: rgba(255, 255, 255, 0.3) transparent;
      }
      
      .modal-body::-webkit-scrollbar {
        width: 8px;
      }
      
      .modal-body::-webkit-scrollbar-track {
        background: transparent;
      }
      
      .modal-body::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.3);
        border-radius: 4px;
      }
      
      .modal-body::-webkit-scrollbar-thumb:hover {
        background: rgba(255, 255, 255, 0.5);
      }
      
      .two-column-form {
        display: flex;
        flex-wrap: wrap;
        gap: 25px;
      }
      
      .form-column {
        flex: 1;
        min-width: 300px;
      }
      
      .full-width {
        width: 100%;
      }
      
      .full-width-select,
      .full-width-input {
        width: 100% !important;
      }
      
      .modal-title {
        margin: 0;
        font-weight: 700;
        color: #fff;
        font-size: 1.5em;
        letter-spacing: 0.5px;
        display: flex;
        align-items: center;
      }
      
      .modal-description {
        color: #aaa;
        margin-top: 8px;
        font-size: 14px;
        font-weight: 300;
      }
      
      .add-event-modal .form-group label {
        color: #e5e5e5;
        font-size: 0.9em;
        font-weight: 600;
        margin-bottom: 8px;
        display: block;
      }
      
      .add-event-modal .form-group input,
      .add-event-modal .form-group textarea,
      .add-event-modal select,
      .add-event-modal .tag-input {
        background: rgba(60, 60, 60, 0.4);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: #e5e5e5;
        border-radius: 6px;
        padding: 12px 15px;
        transition: all 0.3s ease;
      }
      
      .add-event-modal .form-group input:focus,
      .add-event-modal .form-group textarea:focus,
      .add-event-modal select:focus,
      .add-event-modal .tag-input:focus {
        border-color: #666666;
        box-shadow: 0 0 0 2px rgba(102, 102, 102, 0.25);
        background: rgba(70, 70, 70, 0.5);
      }
      
      .add-event-modal .form-group input::placeholder,
      .add-event-modal .form-group textarea::placeholder,
      .add-event-modal .tag-input::placeholder {
        color: #999;
      }
      
      .add-event-modal .tag-hint {
        color: #999;
        font-size: 0.8em;
        margin-top: 5px;
        display: flex;
        align-items: center;
        gap: 5px;
      }
      
      .add-event-modal .tag-hint::before {
        content: "💡";
        font-size: 1.1em;
      }
      
      .add-event-modal .form-group {
        margin-bottom: 16px;
      }
      
      .add-event-modal .form-footer {
        margin-top: 25px;
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        border-top: 1px solid rgba(255, 255, 255, 0.08);
        padding-top: 20px;
      }
      
      .add-event-modal .cancel-btn {
        background: rgba(80, 80, 80, 0.4);
        color: #e5e5e5;
        padding: 8px 16px;
        width: 80px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
        text-align: center;
      }
      
      .add-event-modal .cancel-btn:hover {
        background: rgba(100, 100, 100, 0.4);
      }
      
      .add-event-modal .submit-btn {
        background: linear-gradient(135deg, #666666, #888888);
        color: white;
        padding: 8px 16px;
        width: 110px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
        text-align: center;
      }
      
      .add-event-modal .submit-btn:hover {
        background: linear-gradient(135deg, #777777, #999999);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
      }

      .close {
        position: absolute;
        top: 20px;
        right: 20px;
        font-size: 24px;
        font-weight: bold;
        cursor: pointer;
        color: rgba(255, 255, 255, 0.7);
        width: 36px;
        height: 36px;
        display: flex;
        justify-content: center;
        align-items: center;
        border-radius: 4px;
        background: rgba(0, 0, 0, 0.3);
        z-index: 10;
      }

      .close:hover {
        color: #fff;
        background: rgba(0, 0, 0, 0.5);
      }

      .month-selector {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 20px;
        margin-bottom: 20px;
      }

      .month-btn {
        background: linear-gradient(135deg, #666666, #777777);
        color: white;
        border: none;
        padding: 10px 18px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 600;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      }

      .month-btn:hover {
        background: linear-gradient(135deg, #777777, #888888);
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
      }

      .current-month {
        font-size: 1.3em;
        font-weight: 700;
        color: #ffffff;
      }

      /* 留言區域樣式 */
      .comments-section {
        margin-top: 30px;
        border-top: 2px solid #e2e8f0;
        padding-top: 20px;
      }

      .comments-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }

      .comments-title {
        font-size: 1.2em;
        font-weight: 600;
        color: #4a5568;
      }

      .comments-count {
        color: #667eea;
        font-size: 0.9em;
      }

      .comment-form {
        background: #f8fafc;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 20px;
      }

      .comment-input {
        width: 100%;
        padding: 10px;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        resize: vertical;
        min-height: 60px;
        font-size: 14px;
      }

      .comment-input:focus {
        outline: none;
        border-color: #667eea;
      }

      .comment-form-actions {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 10px;
      }

      .comment-author-input {
        padding: 8px 12px;
        border: 1px solid #e2e8f0;
        border-radius: 6px;
        font-size: 14px;
        width: 150px;
      }

      .comment-submit {
        background: #667eea;
        color: white;
        padding: 8px 20px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        transition: background 0.3s ease;
      }

      .comment-submit:hover {
        background: #5a67d8;
      }

      .comments-list {
        max-height: 300px;
        overflow-y: auto;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        padding: 10px;
        background: #fafafa;
      }

      .comment-item {
        background: white;
        border-radius: 8px;
        padding: 12px;
        margin-bottom: 10px;
        border-left: 3px solid #667eea;
      }

      .comment-item.reply {
        margin-left: 30px;
        border-left-color: #a0aec0;
        background: #f7fafc;
      }

      .comment-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
      }

      .comment-author {
        font-weight: 600;
        color: #4a5568;
        font-size: 14px;
      }

      .comment-time {
        color: #a0aec0;
        font-size: 12px;
      }

      .comment-content {
        color: #4a5568;
        line-height: 1.4;
        margin-bottom: 8px;
        font-size: 14px;
      }

      .comment-actions {
        display: flex;
        gap: 10px;
      }

      .reply-btn {
        background: none;
        border: none;
        color: #667eea;
        cursor: pointer;
        font-size: 12px;
        padding: 2px 8px;
        border-radius: 4px;
        transition: background 0.3s ease;
      }

      .reply-btn:hover {
        background: #e2e8f0;
      }

      .reply-form {
        margin-top: 10px;
        padding: 10px;
        background: #f0f4f8;
        border-radius: 6px;
        display: none;
      }

      .reply-form.active {
        display: block;
      }

      .reply-input {
        width: 100%;
        padding: 8px;
        border: 1px solid #e2e8f0;
        border-radius: 6px;
        font-size: 13px;
        min-height: 50px;
        resize: vertical;
      }

      .reply-form-actions {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 8px;
      }

      .reply-author-input {
        padding: 6px 10px;
        border: 1px solid #e2e8f0;
        border-radius: 4px;
        font-size: 13px;
        width: 120px;
      }

      .reply-submit {
        background: #667eea;
        color: white;
        padding: 6px 15px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 13px;
      }

      .cancel-reply {
        background: #a0aec0;
        color: white;
        padding: 6px 15px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 13px;
        margin-right: 8px;
      }

      .load-more-comments {
        text-align: center;
        margin-top: 15px;
      }

      .load-more-btn {
        background: #e2e8f0;
        color: #4a5568;
        padding: 8px 20px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        transition: background 0.3s ease;
      }

      .load-more-btn:hover {
        background: #cbd5e0;
      }

      .no-comments {
        text-align: center;
        color: #a0aec0;
        padding: 20px;
        font-style: italic;
      }

      .replying-to {
        background: #e2e8f0;
        padding: 5px 10px;
        border-radius: 4px;
        font-size: 12px;
        color: #4a5568;
        margin-bottom: 8px;
      }

      /* Google Maps 相關樣式 */
      .location-info {
        margin-top: 8px;
        padding: 8px;
        background: #f0f9ff;
        border: 1px solid #bae6fd;
        border-radius: 6px;
        font-size: 14px;
      }

      .location-preview {
        display: flex;
        align-items: center;
        gap: 8px;
        color: #0369a1;
      }

      .location-link {
        color: #0369a1;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 5px;
        font-weight: 500;
      }

      .location-link:hover {
        text-decoration: underline;
      }

      .location-icon {
        width: 16px;
        height: 16px;
      }

      .event-location-link {
        color: #0369a1;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 5px;
        font-weight: 500;
      }

      .event-location-link:hover {
        text-decoration: underline;
      }

      /* 標籤相關樣式 */
      .tags-input-container {
        margin-top: 6px;
      }

      .tags-display {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-bottom: 10px;
        min-height: 0;
        padding: 5px 0;
      }
      
      .tags-display:empty {
        display: none;
      }

      .tag {
        background: linear-gradient(135deg, #666666, #888888);
        color: #ffffff;
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 0.8em;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 5px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
        border: 1px solid rgba(255, 255, 255, 0.15);
        letter-spacing: 0.5px;
        margin: 3px;
      }

      .tag-remove {
        background: rgba(255, 255, 255, 0.3);
        border: none;
        color: #ffffff;
        cursor: pointer;
        padding: 0;
        margin-left: 2px;
        font-size: 12px;
        width: 14px;
        height: 14px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
      }

      .tag-remove:hover {
        background: rgba(255, 255, 255, 0.4);
        transform: scale(1.1);
      }

      .tag-input {
        padding: 10px 15px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 6px;
        font-size: 14px;
        outline: none;
        transition: all 0.3s ease;
        background: rgba(60, 60, 60, 0.4);
        color: #e5e5e5;
        font-family: "Inter", sans-serif;
        width: 100%;
      }

      .tag-input:focus {
        border-color: #666666;
        box-shadow: 0 0 0 2px rgba(102, 102, 102, 0.25);
        background: rgba(70, 70, 70, 0.5);
      }

      .tag-hint {
        font-size: 11px;
        color: #999999;
        margin-top: 3px;
        font-weight: 400;
      }

      .event-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 12px;
      }

      .event-tag {
        background: linear-gradient(135deg, #666666, #888888);
        color: #ffffff;
        padding: 5px 14px;
        border-radius: 20px;
        font-size: 0.85em;
        font-weight: 600;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
        letter-spacing: 0.5px;
        text-shadow: 0 1px 1px rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.15);
        margin: 3px;
        display: inline-block;
      }

      /* 圖片上傳樣式 */
      .image-upload-container {
        margin-top: 6px;
      }
      
      .image-upload-area {
        border: 2px dashed rgba(255, 255, 255, 0.3);
        border-radius: 8px;
        padding: 20px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        background: rgba(50, 50, 50, 0.3);
        position: relative;
        min-height: 120px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      .image-upload-area:hover {
        border-color: rgba(255, 255, 255, 0.5);
        background: rgba(60, 60, 60, 0.4);
      }
      
      .image-preview {
        position: relative;
        width: 100%;
        max-width: 200px;
      }
      
      .remove-image {
        position: absolute;
        top: -8px;
        right: -8px;
        background: rgba(255, 0, 0, 0.8);
        color: white;
        border: none;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        cursor: pointer;
        font-size: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
      }
      
      .remove-image:hover {
        background: rgba(255, 0, 0, 1);
        transform: scale(1.1);
      }
      
      .upload-placeholder {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }
      
      .image-hint {
        font-size: 11px;
        color: #999999;
        margin-top: 8px;
        font-weight: 400;
        display: flex;
        align-items: center;
        gap: 5px;
      }
      
      /* Tab 切換樣式 */
      .modal-tabs {
        display: flex;
        border-bottom: 1px solid #e2e8f0;
        margin-bottom: 20px;
      }
      
      .modal-tab {
        flex: 1;
        padding: 12px 16px;
        background: none;
        border: none;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        color: #666;
        transition: all 0.3s ease;
        border-bottom: 2px solid transparent;
      }
      
      .modal-tab.active {
        color: #4a5568;
        border-bottom-color: #667eea;
      }
      
      .modal-tab:hover {
        background: #f8fafc;
      }
      
      .tab-content {
        display: none;
      }
      
      .tab-content.active {
        display: block;
      }
      
      .poster-image {
        width: 100%;
        max-width: 500px;
        height: auto;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      
      .poster-image:hover {
        transform: scale(1.02);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      }
      
      .poster-container {
        text-align: center;
        padding: 20px;
      }
      
      /* 全螢幕圖片檢視 */
      .image-fullscreen {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        z-index: 2000;
        align-items: center;
        justify-content: center;
      }
      
      .image-fullscreen.active {
        display: flex;
      }
      
      .fullscreen-image {
        max-width: 90%;
        max-height: 90%;
        object-fit: contain;
      }
      
      .fullscreen-close {
        position: absolute;
        top: 20px;
        right: 20px;
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        cursor: pointer;
        font-size: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
      }
      
      .fullscreen-close:hover {
        background: rgba(255, 255, 255, 0.3);
      }

      .event-official-url {
        margin-top: 10px;
        padding-top: 10px;
        border-top: 1px solid #e2e8f0;
      }

      .official-url-link {
        color: #ffffff;
        text-decoration: none;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-size: 0.9em;
        transition: all 0.3s ease;
        background: rgba(120, 120, 120, 0.8);
        padding: 4px 10px;
        border-radius: 4px;
      }

      .official-url-link:hover {
        color: #ffffff;
        background: rgba(140, 140, 140, 0.8);
        transform: translateY(-1px);
      }

      .external-link-icon {
        width: 14px;
        height: 14px;
      }

      .location-info {
        display: none;
      }

      /* 彈窗詳情標籤樣式 */
      .event-details strong {
        color: #4a5568;
        font-weight: 700;
        font-size: 1em;

      }

      /* 彈窗中內容值的樣式 */
      .modal-content .event-location-link {
        color: #444444;
        font-weight: 600;
      }

      .modal-content .event-location-link:hover {
        color: #222222;
      }

      .modal-content .event-cost-value {
        color: #444444;
        font-weight: 600;
      }

      .modal-content .official-url-link {
        color: #444444;
        background: rgba(240, 240, 240, 0.8);
        font-weight: 600;
      }

      .modal-content .official-url-link:hover {
        color: #222222;
        background: rgba(220, 220, 220, 0.8);
      }

      .modal-content {
        color: #444444;
        font-weight: 600;
      }

      /* 表單緊湊佈局 */
      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 0;
      }

      .form-row .form-group {
        margin-bottom: 16px;
      }

      @media (max-width: 600px) {
        .form-row {
          grid-template-columns: 1fr;
          gap: 0;
        }
      }

      /* 日期活動彈窗樣式 */
      .daily-events-modal {
        background: rgba(28, 28, 30, 0.95);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.6);
        padding: 25px;
        color: #e5e5e5;
        max-width: 90%;
        width: 450px;
      }
      
      .mobile-daily-events-content {
        max-height: 70vh;
        overflow-y: auto;
      }
      
      .mobile-daily-events-content h3 {
        color: #ffffff;
        margin-bottom: 20px;
        text-align: center;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        padding-bottom: 12px;
      }
      
      /* 響應式樣式 */
      @media (max-width: 768px) {
        .main-content {
          grid-template-columns: 1fr;
          gap: 20px;
        }

        .events-grid {
          grid-template-columns: 1fr;
        }
        
        .form-column {
          flex: 100%;
        }
        
        .modal-content.add-event-modal {
          width: 95%;
          max-height: 90vh;
          overflow-y: auto;
        }
        
        /* 手機版分享活動彈窗滾動條樣式 */
        .modal-content.add-event-modal::-webkit-scrollbar {
          width: 8px;
        }
        
        .modal-content.add-event-modal::-webkit-scrollbar-track {
          background: rgba(255, 255, 255, 0.1);
          border-radius: 4px;
        }
        
        .modal-content.add-event-modal::-webkit-scrollbar-thumb {
          background: rgba(255, 255, 255, 0.3);
          border-radius: 4px;
        }
        
        .modal-content.add-event-modal::-webkit-scrollbar-thumb:hover {
          background: rgba(255, 255, 255, 0.5);
        }
        
        /* 手機版 modal-body 滾動條加強 */
        .modal-content.add-event-modal .modal-body::-webkit-scrollbar {
          width: 10px;
        }
        
        .modal-content.add-event-modal .modal-body::-webkit-scrollbar-track {
          background: rgba(255, 255, 255, 0.1);
          border-radius: 4px;
        }
        
        .modal-content.add-event-modal .modal-body::-webkit-scrollbar-thumb {
          background: rgba(255, 255, 255, 0.4);
          border-radius: 4px;
        }
        
        .modal-content.add-event-modal .modal-body::-webkit-scrollbar-thumb:hover {
          background: rgba(255, 255, 255, 0.6);
        }
        
        /* 在手機版中隱藏桌面版日期活動區塊 */
        .main-content .card:nth-child(2) {
          display: none;
        }
      }

      /* 確保桌面版顯示日期活動區塊 */
      @media (min-width: 769px) {
        .main-content .card:nth-child(2) {
          display: block;
        }
      }

      /* 預設隱藏右側面板 */
      .modal-right-panel {
        display: none;
      }

      /* 預設顯示mobile討論區 */
      .comments-section-mobile {
        display: block;
      }

      /* Desktop版本的modal左右分欄佈局 */
      @media (min-width: 769px) {
        .modal-content {
          max-width: 1200px !important;
          padding: 0 !important;
          display: flex !important;
          max-height: 85vh;
        }            .modal-left-panel {
                flex: 1;
                padding: 30px;
                overflow-y: auto;
                max-height: 85vh;
                /* 隱藏滾動條 */
                scrollbar-width: none; /* Firefox */
                -ms-overflow-style: none; /* IE and Edge */
            }

            .modal-left-panel::-webkit-scrollbar {
                display: none; /* Chrome, Safari, Opera */
            }

        .modal-right-panel {
          flex: 1;
          border-left: 1px solid #e2e8f0;
          display: flex !important;
          flex-direction: column;
          max-height: 85vh;
        }

        .comments-section-desktop {
          flex: 1;
          padding: 30px;
          overflow-y: auto;
          display: flex;
          flex-direction: column;
        }

        .comments-section-desktop .comments-list {
          flex: 1;
          overflow-y: auto;
          max-height: none;
        }

        .comments-section-mobile {
          display: none !important;
        }
        
        /* 桌面版隱藏手機版tab */
        .mobile-tabs {
          display: none !important;
        }
        
        .mobile-tab-content {
          display: none !important;
        }
      }

      /* Mobile版本保持原有佈局 */
      @media (max-width: 768px) {
        .modal-content {
          display: block !important;
          padding: 30px !important;
          max-width: 600px !important;
        }

        .modal-left-panel {
          display: block;
        }

        .modal-right-panel {
          display: none !important;
        }

        .comments-section-mobile {
          display: block !important;
        }
        
        /* Mobile版tab樣式 */
        .mobile-tabs {
          display: flex;
          background: #f8fafc;
          border-radius: 8px;
          padding: 4px;
          margin: 20px 0;
        }
        
        .mobile-tab {
          flex: 1;
          padding: 12px 16px;
          background: none;
          border: none;
          cursor: pointer;
          font-size: 14px;
          font-weight: 600;
          color: #666;
          transition: all 0.3s ease;
          border-radius: 6px;
          text-align: center;
        }
        
        .mobile-tab.active {
          color: #4a5568;
          background: #ffffff;
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .mobile-tab:hover {
          background: #e2e8f0;
        }
        
        .mobile-tab.active:hover {
          background: #ffffff;
        }
        
        .mobile-tab-content {
          display: none;
        }
        
        .mobile-tab-content.active {
          display: block;
        }
        
        .mobile-tab-content .poster-container {
          text-align: center;
          padding: 20px;
        }
        
        /* 手機版隱藏桌面版tab */
        .modal-tabs {
          display: none !important;
        }
        
        .tab-content {
          display: none !important;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>OPENGIG</h1>
        <p class="header-subtitle">發現、分享、參與有趣的社群活動</p>
      </div>

      <div class="main-content">
        <!-- 日曆區塊 -->
        <div class="card calendar-section">
          <h2>選擇日期</h2>
          <div class="month-selector">
            <button class="month-btn" onclick="changeMonth(-1)">‹</button>
            <div class="current-month" id="currentMonth">2025年7月</div>
            <button class="month-btn" onclick="changeMonth(1)">›</button>
          </div>
          <div class="calendar" id="calendar"></div>
          <div style="margin-top: 15px; text-align: center;">
            <button id="addEventBtn" class="submit-btn" style="display: none; max-width: 200px; margin: 0 auto;" onclick="showAddEventModal()">分享活動</button>
          </div>
        </div>

        <div class="card">
          <div id="selectedDateEvents" style="padding: 10px;">
            <p style="text-align: center; color: #aaaaaa;">請選擇日期以查看或分享活動</p>
          </div>
        </div>
      </div>
      
      <!-- 新增活動彈窗 -->
      <div id="addEventModal" class="modal">
        <div class="modal-content add-event-modal">
          <div class="modal-header">
            <h2 class="modal-title">
              <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor" style="margin-right: 10px;">
                <path d="M17 12h-5v5h5v-5zM16 1v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-1V1h-2zm3 18H5V8h14v11z"></path>
              </svg>
              分享活動
            </h2>
            <div class="modal-description">分享有趣的活動資訊，為社群增添精彩</div>
          </div>
          <span class="close" onclick="closeAddEventModal()" style="top: 15px; right: 15px;">&times;</span>
          <div class="modal-body">
            <form id="eventForm" class="two-column-form">
              <div class="form-column form-column-left">
                <div class="form-group">
                  <label for="eventTitle">活動標題</label>
                  <input type="text" id="eventTitle" placeholder="輸入發現的活動標題" required />
                </div>
                
                <div class="form-group">
                  <label for="eventContent">活動內容</label>
                  <textarea id="eventContent" placeholder="分享這個活動的內容、特色和值得參與的原因..." required></textarea>
                </div>
                
                <div class="form-group">
                  <label for="eventLocation">地點</label>
                  <input
                    type="text"
                    id="eventLocation"
                    placeholder="請輸入地點名稱或 Google Maps 網址"
                    required
                  />
                  <div class="location-info" id="locationInfo"></div>
                </div>
                
                <div class="form-row">
                  <div class="form-group" >
                    <label for="eventType">活動天數</label>
                    <select id="eventType" onchange="toggleDateEndField()" style="width: 100%">
                      <option value="single">單日活動</option>
                      <option value="multi">多日活動</option>
                    </select>
                  </div>
                  <div class="form-group" id="eventEndDateGroup" style="display: none;">
                    <label for="eventEndDate">結束日期</label>
                    <input type="date" id="eventEndDate" />
                  </div>
                </div>
              </div>
              
              <div class="form-column form-column-right">
                <div class="form-row">
                  <div class="form-group">
                    <label for="eventCost">費用</label>
                    <input type="text" id="eventCost" placeholder="免費 或 $100" />
                  </div>
                  <div class="form-group">
                    <label for="eventOfficialUrl">官方網址</label>
                    <input
                      type="url"
                      id="eventOfficialUrl"
                      placeholder="https://example.com"
                    />
                  </div>
                </div>
                
                <div class="form-group">
                  <label for="eventTags">標籤</label>
                  <div class="tags-input-container">
                    <div class="tags-display" id="tagsDisplay"></div>
                    <input
                      type="text"
                      id="tagInput"
                      class="tag-input"
                      placeholder="輸入標籤名稱後按 Enter"
                    />
                    <div class="tag-hint">
                      <svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor" style="margin-right: 4px;">
                        <path d="M11.251 4v16M4.751 10.5h13M4.751 13.5h13"></path>
                      </svg>
                      最多可以加入 3 個標籤，輸入後按 Enter 確認
                    </div>
                  </div>
                </div>
                
                <div class="form-group">
                  <label for="eventImage">活動海報圖片</label>
                  <div class="image-upload-container">
                    <input
                      type="file"
                      id="eventImage"
                      accept="image/*"
                      style="display: none;"
                      onchange="handleImageUpload(event)"
                    />
                    <div class="image-upload-area" onclick="document.getElementById('eventImage').click()">
                      <div class="image-preview" id="imagePreview" style="display: none;">
                        <img id="previewImg" src="" alt="預覽圖片" style="width: 100%; height: 150px; object-fit: cover; border-radius: 6px;">
                        <button type="button" class="remove-image" onclick="removeImage(event)">×</button>
                      </div>
                      <div class="upload-placeholder" id="uploadPlaceholder">
                        <svg viewBox="0 0 24 24" width="32" height="32" fill="currentColor" style="margin-bottom: 8px; color: #888;">
                          <path d="M19 7v2.99s-1.99.01-2 0V7h-3s.01-1.99 0-2h3V2h2v3h3v2h-3zm-3 4V9h-3V7H5c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-8h-3zM5 19l3-4 2 3 3-4 4 5H5z"/>
                        </svg>
                        <p style="margin: 0; color: #888; font-size: 14px;">點擊上傳活動海報</p>
                        <p style="margin: 5px 0 0 0; color: #666; font-size: 12px;">支援 JPG、PNG 格式</p>
                      </div>
                    </div>
                    <div class="image-hint">
                      <svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor" style="margin-right: 4px;">
                        <path d="M11.251 4v16M4.751 10.5h13M4.751 13.5h13"></path>
                      </svg>
                      建議尺寸：16:9 比例，檔案大小不超過 2MB
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="form-footer full-width">
                <button type="button" class="cancel-btn" onclick="closeAddEventModal()">取消</button>
                <button type="submit" class="submit-btn">
                  分享活動
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- 活動列表區塊 -->
      <div class="events-section">
        <h2>精彩活動</h2>
        <div style="text-align: center; margin-bottom: 20px; color: #cccccc;">
          <p>社群共同發掘的活動 · 僅顯示今天及未來的活動</p>
        </div>
        <div class="events-grid" id="eventsGrid"></div>
      </div>
    </div>

    <!-- 活動詳情彈窗 -->
    <div id="eventModal" class="modal event-modal">
      <div class="modal-content">
        <span class="close" onclick="closeEventModal()">&times;</span>
        <div class="modal-left-panel" id="modalLeftPanel"></div>
        <div class="modal-right-panel" id="modalRightPanel"></div>
      </div>
    </div>
    
    <!-- 手機版當日活動彈窗 -->
    <div id="dailyEventsModal" class="modal">
      <div class="modal-content daily-events-modal">
        <span class="close" onclick="closeDailyEventsModal()">&times;</span>
        <div id="mobileSelectedDateEvents" class="mobile-daily-events-content"></div>
      </div>
    </div>
    
    <!-- 全螢幕圖片檢視 -->
    <div id="imageFullscreen" class="image-fullscreen">
      <button class="fullscreen-close" onclick="closeFullscreenImage()">&times;</button>
      <img id="fullscreenImg" src="" alt="全螢幕圖片" class="fullscreen-image">
    </div>

    <script>
      // 資料儲存
      let events = [];
      let comments = {};
      let commentIdCounter = 100;
      let currentMonth = 6; // 7月 (0-based)
      let currentYear = 2025;
      let selectedDate = null;
      let currentTags = []; // 儲存當前正在輸入的標籤

      // 載入資料
      async function loadData() {
        try {
          const response = await fetch("data.json");
          const data = await response.json();
          events = data.events;
          comments = data.comments;
          commentIdCounter = data.settings.commentIdCounter;
          currentMonth = data.settings.currentMonth;
          currentYear = data.settings.currentYear;
          selectedDate = data.settings.selectedDate;
          currentTags = data.settings.currentTags;

          // 載入完成後初始化頁面
          generateCalendar();
          displayEvents();
        } catch (error) {
          console.error("載入資料失敗:", error);
          // 如果載入失敗，使用預設空資料
          events = [];
          comments = {};
          generateCalendar();
          displayEvents();
        }
      }

      // 初始化
      document.addEventListener("DOMContentLoaded", function () {
        loadData(); // 載入JSON資料
        setupEventListeners();
        setupLocationInput();
        setupTagsInput();
        
        // 檢查視窗寬度，根據裝置類型初始化UI
        checkDeviceWidth();
      });
      
      // 檢查裝置寬度，適配不同顯示方式
      function checkDeviceWidth() {
        const isMobile = window.innerWidth <= 768;
        const cardContainer = document.querySelector('.main-content .card:nth-child(2)');
        
        if (cardContainer) {
          // 手機版隱藏，桌面版顯示
          cardContainer.style.display = isMobile ? 'none' : 'block';
        }
      }
      
      // 監聽視窗大小變化
      window.addEventListener('resize', checkDeviceWidth);

      function setupLocationInput() {
        const locationInput = document.getElementById("eventLocation");
        const locationInfo = document.getElementById("locationInfo");

        locationInput.addEventListener("input", function () {
          const value = this.value.trim();

          if (isGoogleMapsUrl(value)) {
            const locationName = extractLocationName(value);
            showLocationPreview(locationName, value);
          } else {
            hideLocationPreview();
          }
        });

        function showLocationPreview(name, url) {
          locationInfo.innerHTML = `
                    <div class="location-preview">
                        <svg class="location-icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                        </svg>
                        <span>地點: ${name}</span>
                        <a href="${url}" target="_blank" class="location-link">
                            <svg class="location-icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"/>
                            </svg>
                            在 Google Maps 中查看
                        </a>
                    </div>
                `;
          locationInfo.style.display = "block";
        }

        function hideLocationPreview() {
          locationInfo.style.display = "none";
        }
      }

      function isGoogleMapsUrl(url) {
        return (
          url.includes("maps.google.com") ||
          url.includes("goo.gl/maps") ||
          url.includes("maps.app.goo.gl") ||
          url.includes("google.com/maps")
        );
      }

      function extractLocationName(url) {
        // 嘗試從 URL 中解析地點名稱
        let locationName = "未知地點";

        try {
          // 處理不同格式的 Google Maps URL
          if (url.includes("?q=")) {
            const match = url.match(/[?&]q=([^&]+)/);
            if (match) {
              locationName = decodeURIComponent(match[1]).replace(/\+/g, " ");
            }
          } else if (url.includes("/place/")) {
            const match = url.match(/\/place\/([^\/]+)/);
            if (match) {
              locationName = decodeURIComponent(match[1]).replace(/\+/g, " ");
            }
          } else if (url.includes("@")) {
            // 處理座標格式的 URL
            const match = url.match(/([^\/]+)\/.*@/);
            if (match) {
              locationName = decodeURIComponent(match[1]).replace(/\+/g, " ");
            }
          }
        } catch (e) {
          console.error("解析地點名稱時出錯:", e);
        }

        return locationName;
      }

      function formatLocationDisplay(location, locationUrl) {
        if (locationUrl && isGoogleMapsUrl(locationUrl)) {
          return `
                    <a href="${locationUrl}" target="_blank" class="event-location-link">
                        <svg class="location-icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                        </svg>
                        ${location}
                    </a>
                `;
        } else {
          return `
                    <span>
                        <svg class="location-icon" viewBox="0 0 24 24" fill="currentColor" style="width: 16px; height: 16px; margin-right: 5px; vertical-align: text-bottom;">
                            <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                        </svg>
                        ${location}
                    </span>
                `;
        }
      }

      function setupEventListeners() {
        // 表單提交
        document
          .getElementById("eventForm")
          .addEventListener("submit", function (e) {
            e.preventDefault();
            addEvent();
          });

        // 點擊彈窗外部關閉
        window.addEventListener("click", function (e) {
          const eventModal = document.getElementById("eventModal");
          const addEventModal = document.getElementById("addEventModal");
          const dailyEventsModal = document.getElementById("dailyEventsModal");
          
          // 如果活動詳情彈窗開啟，優先處理它
          if (e.target === eventModal && eventModal.style.display === "block") {
            closeEventModal();
          }
          // 如果只有日期活動彈窗開啟
          else if (e.target === dailyEventsModal && dailyEventsModal.style.display === "block") {
            dailyEventsModal.style.display = "none";
          }
          
          if (e.target === addEventModal) {
            addEventModal.style.display = "none";
          }
        });
        
        // 監聽視窗大小變化，以正確處理不同裝置上的顯示方式
        window.addEventListener("resize", function() {
          const dailyEventsModal = document.getElementById("dailyEventsModal");
          
          // 如果在桌面視圖下且日期活動彈窗是開啟的，關閉它
          if (window.innerWidth > 768 && dailyEventsModal.style.display === "block") {
            dailyEventsModal.style.display = "none";
          }
        });
      }
      
      function closeEventModal() {
        const modal = document.getElementById("eventModal");
        
        // 關閉活動詳情彈窗
        modal.style.display = "none";
        
        // 清除狀態
        modal.removeAttribute('data-from-daily-modal');
      }
      
      function showAddEventModal() {
        document.getElementById("addEventModal").style.display = "block";
      }
      
      function closeAddEventModal() {
        document.getElementById("addEventModal").style.display = "none";
      }
      
      function closeDailyEventsModal() {
        document.getElementById("dailyEventsModal").style.display = "none";
      }

      function generateCalendar() {
        const calendar = document.getElementById("calendar");
        const monthNames = [
          "1月",
          "2月",
          "3月",
          "4月",
          "5月",
          "6月",
          "7月",
          "8月",
          "9月",
          "10月",
          "11月",
          "12月",
        ];
        const dayNames = ["日", "一", "二", "三", "四", "五", "六"];

        document.getElementById(
          "currentMonth"
        ).textContent = `${currentYear}年${monthNames[currentMonth]}`;

        calendar.innerHTML = "";

        // 添加星期標題
        dayNames.forEach((day) => {
          const dayHeader = document.createElement("div");
          dayHeader.className = "calendar-header";
          dayHeader.textContent = day;
          calendar.appendChild(dayHeader);
        });

        // 獲取月份資訊
        const firstDay = new Date(currentYear, currentMonth, 1);
        const lastDay = new Date(currentYear, currentMonth + 1, 0);
        const startingDayOfWeek = firstDay.getDay();
        const daysInMonth = lastDay.getDate();

        // 添加空白日期
        for (let i = 0; i < startingDayOfWeek; i++) {
          const emptyDay = document.createElement("div");
          calendar.appendChild(emptyDay);
        }

        // 添加日期
        for (let day = 1; day <= daysInMonth; day++) {
          const dayElement = document.createElement("div");
          dayElement.className = "calendar-day";
          dayElement.textContent = day;

          const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(
            2,
            "0"
          )}-${String(day).padStart(2, "0")}`;

          // 檢查是否有活動
          const hasEvent = events.some((event) => event.date === dateStr);
          if (hasEvent) {
            dayElement.classList.add("has-event");
          }
          
          // 檢查是否為過去日期
          const currentDate = new Date();
          currentDate.setHours(0, 0, 0, 0);
          const calendarDate = new Date(dateStr);
          if (calendarDate < currentDate) {
            dayElement.classList.add("past-date");
          }

          dayElement.addEventListener("click", function () {
            document
              .querySelectorAll(".calendar-day")
              .forEach((d) => d.classList.remove("selected"));
            this.classList.add("selected");
            selectedDate = dateStr;
            
            // 顯示「新增活動」按鈕
            document.getElementById("addEventBtn").style.display = "block";
            
            // 顯示當日活動
            updateSelectedDateEvents(dateStr);
          });

          calendar.appendChild(dayElement);
        }
      }

      function changeMonth(direction) {
        currentMonth += direction;
        if (currentMonth > 11) {
          currentMonth = 0;
          currentYear++;
        } else if (currentMonth < 0) {
          currentMonth = 11;
          currentYear--;
        }
        generateCalendar();
      }

      function updateSelectedDateEvents(dateStr) {
        const selectedDateEventsDiv = document.getElementById("selectedDateEvents");
        const mobileSelectedDateEventsDiv = document.getElementById("mobileSelectedDateEvents");
        const dateEvents = events.filter(event => event.date === dateStr);
        
        let htmlContent = '';
        
        if (dateEvents.length === 0) {
          htmlContent = `<p style="text-align: center; color: #aaaaaa;">此日期尚無活動</p>`;
        } else {
          htmlContent = `<h3 style="margin-bottom: 15px;">${formatDate(dateStr)}的活動</h3>`;
          htmlContent += `<ul style="list-style-type: none; padding: 0;">`;
          
          dateEvents.forEach(event => {
            const eventComments = comments[event.id] || [];
            const totalComments = eventComments.reduce((count, comment) => count + 1 + comment.replies.length, 0);
            
            // 桌面版使用一般的showEventModal，手機版使用showEventFromDailyModal
            const clickHandler = window.innerWidth <= 768 ? 
              `showEventFromDailyModal(events.find(e => e.id === ${event.id}))` : 
              `showEventModal(events.find(e => e.id === ${event.id}))`;
            
            htmlContent += `
              <li style="margin-bottom: 10px; padding: 10px; background: rgba(60, 60, 60, 0.5); border-radius: 8px; cursor: pointer;" 
                  onclick="${clickHandler}">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                  <strong>${event.title}</strong>
                  <span style="color: #cccccc; font-size: 0.85em;">(${totalComments} 則留言)</span>
                </div>
                <div style="margin-top: 5px; color: #aaaaaa; font-size: 0.9em;">
                  ${event.location} · ${event.cost}
                </div>
              </li>
            `;
          });
          
          htmlContent += `</ul>`;
        }
        
        // 更新桌面版內容區塊
        if (selectedDateEventsDiv) {
          selectedDateEventsDiv.innerHTML = htmlContent;
        }
        
        // 更新移動版彈窗內容
        if (mobileSelectedDateEventsDiv) {
          mobileSelectedDateEventsDiv.innerHTML = htmlContent;
          
          // 如果是在手機視圖下，彈出modal
          if (window.innerWidth <= 768) {
            document.getElementById("dailyEventsModal").style.display = "block";
          }
        }
      }
      
      function closeDailyEventsModal() {
        document.getElementById("dailyEventsModal").style.display = "none";
      }
      
      // 從日期活動彈窗中顯示活動詳情
      function showEventFromDailyModal(event) {
        // 直接顯示活動詳情彈窗，不關閉日期活動彈窗
        showEventModal(event, true);
      }
      
      function toggleDateEndField() {
        const eventType = document.getElementById("eventType").value;
        const endDateGroup = document.getElementById("eventEndDateGroup");
        
        if (eventType === "multi") {
          endDateGroup.style.display = "block";
          
          // 設置結束日期的默認值為選中的開始日期
          if (selectedDate) {
            const defaultEndDate = new Date(selectedDate);
            defaultEndDate.setDate(defaultEndDate.getDate() + 1); // 默認加一天
            
            const formattedEndDate = defaultEndDate.toISOString().split('T')[0];
            document.getElementById("eventEndDate").value = formattedEndDate;
          }
        } else {
          endDateGroup.style.display = "none";
        }
      }
      
      // 產生兩個日期之間的所有日期 (包含起始和結束日期)
      function generateDateRange(startDate, endDate) {
        const start = new Date(startDate);
        const end = new Date(endDate);
        const dateArray = [];
        
        let currentDate = new Date(start);
        
        // 添加所有日期
        while (currentDate <= end) {
          dateArray.push(currentDate.toISOString().split('T')[0]);
          currentDate.setDate(currentDate.getDate() + 1);
        }
        
        return dateArray;
      }
      
      function addEvent() {
        if (!selectedDate) {
          alert("請先選擇日期");
          return;
        }

        const title = document.getElementById("eventTitle").value;
        const content = document.getElementById("eventContent").value;
        const cost = document.getElementById("eventCost").value || "免費";
        const locationInput = document.getElementById("eventLocation").value;
        const officialUrl = document.getElementById("eventOfficialUrl").value || null;
        const eventType = document.getElementById("eventType").value;

        let location = locationInput;
        let locationUrl = null;

        // 如果輸入的是 Google Maps URL，解析地點名稱
        if (isGoogleMapsUrl(locationInput)) {
          location = extractLocationName(locationInput);
          locationUrl = locationInput;
        }
        
        // 處理日期
        let eventDates = [selectedDate];
        let isMultiDay = false;
        
        if (eventType === "multi") {
          const endDate = document.getElementById("eventEndDate").value;
          
          if (!endDate) {
            alert("請選擇結束日期");
            return;
          }
          
          // 確保結束日期不早於開始日期
          if (new Date(endDate) < new Date(selectedDate)) {
            alert("結束日期不能早於開始日期");
            return;
          }
          
          // 產生日期範圍
          eventDates = generateDateRange(selectedDate, endDate);
          isMultiDay = eventDates.length > 1;
        }
        
        const eventId = Date.now();
        
        // 將活動新增到每一天
        eventDates.forEach((date, index) => {
          const newEvent = {
            id: eventId,
            title: title + (isMultiDay ? ` (${index + 1}/${eventDates.length}日)` : ""),
            content,
            cost,
            location,
            locationUrl,
            officialUrl,
            tags: [...currentTags],
            image: selectedImage || `https://picsum.photos/100/150?random=${eventId}`, // 使用上傳的圖片或預設圖片
            date: date,
            status: "pending",
            isMultiDay: isMultiDay,
            multiDayInfo: isMultiDay ? {
              totalDays: eventDates.length,
              currentDay: index + 1,
              allDates: eventDates
            } : null
          };
          
          events.push(newEvent);
        });
        
        displayEvents();
        generateCalendar();
        updateSelectedDateEvents(selectedDate);

        // 清空表單
        document.getElementById("eventForm").reset();
        document.getElementById("locationInfo").style.display = "none";
        currentTags = []; // 清空標籤
        selectedImage = null; // 清空圖片
        document.getElementById("tagsDisplay").innerHTML = "";
        document.getElementById("eventEndDateGroup").style.display = "none"; // 隱藏結束日期欄位
        
        // 重置圖片預覽
        const preview = document.getElementById('imagePreview');
        const placeholder = document.getElementById('uploadPlaceholder');
        if (preview && placeholder) {
          preview.style.display = 'none';
          placeholder.style.display = 'flex';
        }
        
        // 關閉新增活動彈窗
        closeAddEventModal();
        
        alert("感謝分享！活動資訊已送出，待審核後將顯示於列表中");
      }

      function displayEvents() {
        const eventsGrid = document.getElementById("eventsGrid");
        eventsGrid.innerHTML = "";
        
        // 取得今天的日期，格式為 YYYY-MM-DD
        const today = new Date();
        const todayStr = today.toISOString().split('T')[0];

        // 過濾掉過去的活動，只保留今天及未來的活動
        const currentAndFutureEvents = events.filter(event => {
          return event.date >= todayStr;
        });

        // 過濾掉重複的多日活動（只保留每個多日活動的第一天）
        const filteredEvents = currentAndFutureEvents.filter((event, index) => {
          if (!event.isMultiDay) return true;
          
          // 對於多日活動，尋找同一ID的第一個事件
          const firstEventWithId = currentAndFutureEvents.findIndex(e => e.id === event.id);
          return index === firstEventWithId;
        });

        // 排序活動（按日期）
        const sortedEvents = filteredEvents.sort(
          (a, b) => new Date(a.date) - new Date(b.date)
        );

        sortedEvents.forEach((event) => {
          const eventCard = document.createElement("div");
          eventCard.className = `event-card ${
            event.status === "sponsored" ? "sponsored" : ""
          }`;

          const statusText = {
            pending: "審核中",
            approved: "已審核",
            sponsored: "精選活動",
          };

          const statusClass = {
            pending: "status-pending",
            approved: "status-approved",
            sponsored: "status-sponsored",
          };

          // 計算此活動的留言數量
          const eventComments = comments[event.id] || [];
          const totalComments = eventComments.reduce((count, comment) => count + 1 + comment.replies.length, 0);
          
          eventCard.innerHTML = `
                    <div class="event-header">
                        <div>
                            <div class="event-title">${event.title}</div>
                            <div class="event-date">
                                ${event.isMultiDay ? 
                                  `${formatDate(event.multiDayInfo.allDates[0])} - ${formatDate(event.multiDayInfo.allDates[event.multiDayInfo.allDates.length-1])}` : 
                                  formatDate(event.date)}
                            </div>
                        </div>
                        <div class="event-status ${statusClass[event.status]}">
                            ${statusText[event.status]}
                        </div>
                    </div>
                    <div class="event-content">${event.content.substring(
                      0,
                      100
                    )}${event.content.length > 100 ? "..." : ""}</div>
                    ${
                      event.tags && event.tags.length > 0
                        ? `
                        <div class="event-tags">
                            ${event.tags
                              .map(
                                (tag) => `<span class="event-tag">${tag}</span>`
                              )
                              .join("")}
                        </div>
                    `
                        : ""
                    }
                    <div class="event-details">
                        <div class="event-location">${formatLocationDisplay(
                          event.location,
                          event.locationUrl
                        )}</div>
                        <div class="event-cost">${event.cost}</div>
                    </div>
                    <div style="display: flex; justify-content: flex-end; margin-top: 8px;">
                        <div class="event-comments-count" style="color: #cccccc; font-size: 0.85em;">
                            (${totalComments} 則留言)
                        </div>
                    </div>
                    ${
                      event.officialUrl
                        ? `
                        <div class="event-official-url">
                            <a href="${event.officialUrl}" target="_blank" class="official-url-link">
                                <svg class="external-link-icon" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"/>
                                </svg>
                                官方網站
                            </a>
                        </div>
                    `
                        : ""
                    }
                `;

          eventCard.addEventListener("click", function () {
            showEventModal(event);
          });

          eventsGrid.appendChild(eventCard);
        });
      }

    function showEventModal(event, fromDailyModal = false) {
    const modal = document.getElementById('eventModal');
    const modalLeftPanel = document.getElementById('modalLeftPanel');
    const modalRightPanel = document.getElementById('modalRightPanel');
    
    // 儲存是否來自日期活動彈窗的狀態
    modal.setAttribute('data-from-daily-modal', fromDailyModal);

    const statusText = {
        'pending': '審核中',
        'approved': '已審核',
        'sponsored': '精選活動'
    };

    const statusClass = {
        'pending': 'status-pending',
        'approved': 'status-approved',
        'sponsored': 'status-sponsored'
    };

    const eventComments = comments[event.id] || [];
    const totalComments = eventComments.reduce((count, comment) => count + 1 + comment.replies.length, 0);

    modalLeftPanel.innerHTML = `
        <div class="event-header" style="margin-bottom: 15px;">
            <div class="event-title" style="font-size: 1.5em; margin-bottom: 10px;">${event.title}</div>
            <div style="display: flex; align-items: center; gap: 15px;">
                <div class="event-date" style="font-size: 1.1em;">
                    ${event.isMultiDay ? 
                      `多日活動：${formatDate(event.multiDayInfo.allDates[0])} - ${formatDate(event.multiDayInfo.allDates[event.multiDayInfo.allDates.length-1])}` : 
                      formatDate(event.date)}
                </div>
                <div class="event-status ${statusClass[event.status]}">
                    ${statusText[event.status]}
                </div>
            </div>
        </div>
        <div style="margin: 20px 0;">
            <h3 style="margin-bottom: 10px; color: #4a5568;">活動內容</h3>
            <p style="line-height: 1.6; color: #636e72;">${event.content}</p>
        </div>
        ${event.tags && event.tags.length > 0 ? `
            <div style="margin: 15px 0;">
                <h4 style="margin-bottom: 10px; color: #4a5568;">標籤</h4>
                <div class="event-tags">
                    ${event.tags.map(tag => `<span class="event-tag">${tag}</span>`).join('')}
                </div>
            </div>
        ` : ''}
        <div class="event-details" style="margin-top: 20px;">
            <div>
                <strong>費用</strong><br>
                <span class="event-cost-value">${event.cost}</span>
                ${event.officialUrl ? `<br><br><strong>官方網址</strong><br>
                <a href="${event.officialUrl}" target="_blank" class="official-url-link">
                    <svg class="external-link-icon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"/>
                    </svg>
                    查看官方網站
                </a>` : ''}
                <br><br><strong>地點</strong><br>
                ${formatLocationDisplay(event.location, event.locationUrl)}
            </div>
        </div>

        <!-- Mobile版tab系統 -->
        <div class="mobile-tabs">
            <button class="mobile-tab active" onclick="switchMobileTab('poster', ${event.id})">海報</button>
            <button class="mobile-tab" onclick="switchMobileTab('comments', ${event.id})">討論區(${totalComments})</button>
        </div>
        
        <div class="mobile-tab-content active" id="mobile-poster-tab-${event.id}">
            <div class="poster-container">
                <img src="https://picsum.photos/300/220?random=${event.id}" 
                     alt="${event.title}" 
                     class="poster-image"
                     onclick="openFullscreenImage('https://picsum.photos/800/1200?random=${event.id}')">
            </div>
        </div>
        
        <div class="mobile-tab-content" id="mobile-comments-tab-${event.id}">
            <div class="comments-section comments-section-mobile">
                <div class="comment-form">
                    <textarea class="comment-input" placeholder="分享你的想法或經驗..." id="commentInput-mobile-${event.id}"></textarea>
                    <div class="comment-form-actions">
                        <input type="text" class="comment-author-input" placeholder="你的名字" id="commentAuthor-mobile-${event.id}">
                        <button class="comment-submit" onclick="submitComment(${event.id}, 'mobile')">發布留言</button>
                    </div>
                </div>
                <div class="comments-list" id="commentsList-mobile-${event.id}">
                    ${renderComments(eventComments, event.id)}
                </div>
            </div>
        </div>
    `;

    modalRightPanel.innerHTML = `
        <div class="modal-tabs">
            <button class="modal-tab active" onclick="switchTab('poster', ${event.id})">海報</button>
            <button class="modal-tab" onclick="switchTab('comments', ${event.id})">討論區(${totalComments})</button>
        </div>
        
        <div class="tab-content active" id="poster-tab-${event.id}">
            <div class="poster-container">
                <img src="https://picsum.photos/400/600?random=${event.id}" 
                     alt="${event.title}" 
                     class="poster-image"
                     onclick="openFullscreenImage('https://picsum.photos/800/1200?random=${event.id}')">
            </div>
        </div>
        
        <div class="tab-content" id="comments-tab-${event.id}">
            <div class="comments-section-desktop">
                <div class="comment-form">
                    <textarea class="comment-input" placeholder="分享你的想法或經驗..." id="commentInput-desktop-${event.id}"></textarea>
                    <div class="comment-form-actions">
                        <input type="text" class="comment-author-input" placeholder="你的名字" id="commentAuthor-desktop-${event.id}">
                        <button class="comment-submit" onclick="submitComment(${event.id}, 'desktop')">發布留言</button>
                    </div>
                </div>
                <div class="comments-list" id="commentsList-desktop-${event.id}">
                    ${renderComments(eventComments, event.id)}
                </div>
            </div>
        </div>
    `;

    modal.style.display = 'block';
}

      function renderComments(commentList, eventId) {
        if (commentList.length === 0) {
          return '<div class="no-comments">還沒有留言，快來分享你的想法吧！</div>';
        }

        let html = "";
        commentList.forEach((comment) => {
          html += `
                    <div class="comment-item" data-comment-id="${comment.id}">
                        <div class="comment-header">
                            <span class="comment-author">${comment.author}</span>
                            <span class="comment-time">${comment.time}</span>
                        </div>
                        <div class="comment-content">${comment.content}</div>
                        <div class="comment-actions">
                            <button class="reply-btn" onclick="toggleReplyForm(${comment.id}, ${eventId})">回覆</button>
                        </div>
                        <div class="reply-form" id="replyForm-${comment.id}">
                            <div class="replying-to">回覆給 ${comment.author}</div>
                            <textarea class="reply-input" placeholder="輸入回覆..." id="replyInput-${comment.id}"></textarea>
                            <div class="reply-form-actions">
                                <input type="text" class="reply-author-input" placeholder="你的名字" id="replyAuthor-${comment.id}">
                                <div>
                                    <button class="cancel-reply" onclick="cancelReply(${comment.id})">取消</button>
                                    <button class="reply-submit" onclick="submitReply(${comment.id}, ${eventId})">回覆</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

          // 渲染回覆
          comment.replies.forEach((reply) => {
            html += `
                        <div class="comment-item reply">
                            <div class="comment-header">
                                <span class="comment-author">${reply.author}</span>
                                <span class="comment-time">${reply.time}</span>
                            </div>
                            <div class="comment-content">${reply.content}</div>
                        </div>
                    `;
          });
        });

        return html;
      }

      function submitComment(eventId, version = "mobile") {
        const suffix = version === "desktop" ? "desktop" : "mobile";
        const contentInput = document.getElementById(
          `commentInput-${suffix}-${eventId}`
        );
        const authorInput = document.getElementById(
          `commentAuthor-${suffix}-${eventId}`
        );

        const content = contentInput.value.trim();
        const author = authorInput.value.trim() || "匿名用戶";

        if (!content) {
          alert("請輸入留言內容");
          return;
        }

        const newComment = {
          id: ++commentIdCounter,
          author: author,
          content: content,
          time: new Date().toLocaleString("zh-TW", {
            year: "numeric",
            month: "2-digit",
            day: "2-digit",
            hour: "2-digit",
            minute: "2-digit",
          }),
          replies: [],
        };

        if (!comments[eventId]) {
          comments[eventId] = [];
        }

        comments[eventId].push(newComment);

        // 清空輸入框
        contentInput.value = "";
        authorInput.value = "";

        // 重新渲染兩個版本的留言列表
        const commentsListMobile = document.getElementById(
          `commentsList-mobile-${eventId}`
        );
        const commentsListDesktop = document.getElementById(
          `commentsList-desktop-${eventId}`
        );
        const renderedComments = renderComments(comments[eventId], eventId);

        if (commentsListMobile) {
          commentsListMobile.innerHTML = renderedComments;
        }
        if (commentsListDesktop) {
          commentsListDesktop.innerHTML = renderedComments;
        }

        // 更新留言數量
        const totalComments = comments[eventId].reduce(
          (count, comment) => count + 1 + comment.replies.length,
          0
        );
        
        // 更新手機版討論區標題
        document.querySelectorAll(".comments-title").forEach((titleElement) => {
          titleElement.textContent = `討論區(${totalComments})`;
        });
        
        // 更新桌面版tab標題
        document.querySelectorAll(".modal-tab").forEach((tabElement) => {
          if (tabElement.textContent.includes("討論區")) {
            tabElement.textContent = `討論區(${totalComments})`;
          }
        });
      }

      function toggleReplyForm(commentId, eventId) {
        const replyForm = document.getElementById(`replyForm-${commentId}`);

        // 先關閉所有其他回覆表單
        document.querySelectorAll(".reply-form").forEach((form) => {
          if (form.id !== `replyForm-${commentId}`) {
            form.classList.remove("active");
          }
        });

        replyForm.classList.toggle("active");
      }

      function cancelReply(commentId) {
        const replyForm = document.getElementById(`replyForm-${commentId}`);
        replyForm.classList.remove("active");

        // 清空輸入框
        document.getElementById(`replyInput-${commentId}`).value = "";
        document.getElementById(`replyAuthor-${commentId}`).value = "";
      }

      function submitReply(commentId, eventId) {
        const replyInput = document.getElementById(`replyInput-${commentId}`);
        const authorInput = document.getElementById(`replyAuthor-${commentId}`);

        const content = replyInput.value.trim();
        const author = authorInput.value.trim() || "匿名用戶";

        if (!content) {
          alert("請輸入回覆內容");
          return;
        }

        const newReply = {
          id: ++commentIdCounter,
          author: author,
          content: content,
          time: new Date().toLocaleString("zh-TW", {
            year: "numeric",
            month: "2-digit",
            day: "2-digit",
            hour: "2-digit",
            minute: "2-digit",
          }),
        };

        // 找到對應的留言並添加回覆
        const eventComments = comments[eventId];
        const comment = eventComments.find((c) => c.id === commentId);
        if (comment) {
          comment.replies.push(newReply);
        }

        // 關閉回覆表單
        cancelReply(commentId);

        // 重新渲染兩個版本的留言列表
        const commentsListMobile = document.getElementById(
          `commentsList-mobile-${eventId}`
        );
        const commentsListDesktop = document.getElementById(
          `commentsList-desktop-${eventId}`
        );
        const renderedComments = renderComments(comments[eventId], eventId);

        if (commentsListMobile) {
          commentsListMobile.innerHTML = renderedComments;
        }
        if (commentsListDesktop) {
          commentsListDesktop.innerHTML = renderedComments;
        }

        // 更新留言數量
        const totalComments = comments[eventId].reduce(
          (count, comment) => count + 1 + comment.replies.length,
          0
        );
        
        // 更新手機版討論區標題
        document.querySelectorAll(".comments-title").forEach((titleElement) => {
          titleElement.textContent = `討論區(${totalComments})`;
        });
        
        // 更新桌面版tab標題
        document.querySelectorAll(".modal-tab").forEach((tabElement) => {
          if (tabElement.textContent.includes("討論區")) {
            tabElement.textContent = `討論區(${totalComments})`;
          }
        });
      }

      function formatDate(dateStr) {
        const date = new Date(dateStr);
        const months = [
          "1月",
          "2月",
          "3月",
          "4月",
          "5月",
          "6月",
          "7月",
          "8月",
          "9月",
          "10月",
          "11月",
          "12月",
        ];
        return `${date.getFullYear()}年${
          months[date.getMonth()]
        }${date.getDate()}日`;
      }

      function setupTagsInput() {
        const tagInput = document.getElementById("tagInput");
        const tagsDisplay = document.getElementById("tagsDisplay");

        tagInput.addEventListener("keypress", function (e) {
          if (e.key === "Enter") {
            e.preventDefault();
            addTag(this.value.trim());
            this.value = "";
          }
        });

        function addTag(tagText) {
          if (!tagText) return;

          // 檢查是否已達到最大標籤數
          if (currentTags.length >= 3) {
            alert("最多只能加入 3 個標籤");
            return;
          }

          // 檢查是否已存在相同標籤
          if (currentTags.includes(tagText)) {
            alert("此標籤已存在");
            return;
          }

          currentTags.push(tagText);
          updateTagsDisplay();
        }

        function updateTagsDisplay() {
          tagsDisplay.innerHTML = currentTags
            .map(
              (tag, index) => `
                    <div class="tag">
                        ${tag}
                        <button type="button" class="tag-remove" onclick="removeTag(${index})">×</button>
                    </div>
                `
            )
            .join("");
        }

        // 全域函數供按鈕使用
        window.removeTag = function (index) {
          currentTags.splice(index, 1);
          updateTagsDisplay();
        };
      }
      
      // 圖片上傳處理
      let selectedImage = null;
      
      function handleImageUpload(event) {
        const file = event.target.files[0];
        if (!file) return;
        
        // 檢查檔案大小 (2MB)
        if (file.size > 2 * 1024 * 1024) {
          alert('圖片檔案大小不能超過 2MB');
          return;
        }
        
        // 檢查檔案類型
        if (!file.type.startsWith('image/')) {
          alert('請選擇有效的圖片檔案');
          return;
        }
        
        const reader = new FileReader();
        reader.onload = function(e) {
          selectedImage = e.target.result;
          showImagePreview(selectedImage);
        };
        reader.readAsDataURL(file);
      }
      
      function showImagePreview(imageSrc) {
        const preview = document.getElementById('imagePreview');
        const placeholder = document.getElementById('uploadPlaceholder');
        const previewImg = document.getElementById('previewImg');
        
        previewImg.src = imageSrc;
        preview.style.display = 'block';
        placeholder.style.display = 'none';
      }
      
      function removeImage(event) {
        event.stopPropagation();
        selectedImage = null;
        
        const preview = document.getElementById('imagePreview');
        const placeholder = document.getElementById('uploadPlaceholder');
        const fileInput = document.getElementById('eventImage');
        
        preview.style.display = 'none';
        placeholder.style.display = 'flex';
        fileInput.value = '';
      }
      
      // Tab 切換功能
      function switchTab(tabName, eventId) {
        // 移除所有active class
        document.querySelectorAll('.modal-tab').forEach(tab => {
          tab.classList.remove('active');
        });
        document.querySelectorAll('.tab-content').forEach(content => {
          content.classList.remove('active');
        });
        
        // 添加active class到選中的tab
        event.target.classList.add('active');
        document.getElementById(`${tabName}-tab-${eventId}`).classList.add('active');
      }
      
      // 手機版tab切換
      function switchMobileTab(tabName, eventId) {
        // 移除所有active class
        document.querySelectorAll('.mobile-tab').forEach(tab => {
          tab.classList.remove('active');
        });
        document.querySelectorAll('.mobile-tab-content').forEach(content => {
          content.classList.remove('active');
        });
        
        // 添加active class到選中的tab
        event.target.classList.add('active');
        document.getElementById(`mobile-${tabName}-tab-${eventId}`).classList.add('active');
      }
      
      // 全螢幕圖片檢視
      function openFullscreenImage(imageSrc) {
        const fullscreen = document.getElementById('imageFullscreen');
        const fullscreenImg = document.getElementById('fullscreenImg');
        
        fullscreenImg.src = imageSrc;
        fullscreen.classList.add('active');
        
        // 按ESC鍵關閉
        document.addEventListener('keydown', handleEscKey);
      }
      
      function closeFullscreenImage() {
        const fullscreen = document.getElementById('imageFullscreen');
        fullscreen.classList.remove('active');
        
        // 移除ESC鍵監聽
        document.removeEventListener('keydown', handleEscKey);
      }
      
      function handleEscKey(event) {
        if (event.key === 'Escape') {
          closeFullscreenImage();
        }
      }
      
      // 點擊全螢幕背景關閉
      document.addEventListener('click', function(event) {
        const fullscreen = document.getElementById('imageFullscreen');
        if (event.target === fullscreen) {
          closeFullscreenImage();
        }
      });
    </script>
  </body>
</html>
